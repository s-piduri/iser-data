---
title: "ISER Data Section"
author: "Office of Reserach, Planning and Institutional Effectiveness"
date: "`r Sys.Date()`"
output: word_document
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(flextable)
library(officer)

load("../is_standards.RData")
load("../jobs.RData")
load("../demo.RData")
load("../labor_data.RData")
```

```{r}
knitr::opts_chunk$set(tab.topcaption = TRUE)
```


# Introduction

## College History

[Provide a brief history of the institution, including year of establishment. Highlight major events or developments that have occurred since the last comprehensive review.]

## Student Enrollment Data 

[Provide tables/charts summarizing enrollment trends. Disaggregate the data as appropriate for the institution’s mission and service area. Provide brief context if needed.] 

## Labor Market Data 

[Provide summary-level labor market data for the service area. Disaggregate the data as appropriate for the institution’s mission and service area. Provide brief context if needed.] 


```{r, ft.align="left"}
topten %>% flextable::flextable() %>% 
  flextable::set_formatter("Share of Total Employment" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_table_properties(width = 1, layout='autofit') %>% 
  set_caption("Top Industries by Employment", autonum = run_autonum(seq_id='tab', bkm='topten'))
```
```{r, ft.align="left"}
toptech %>% flextable::flextable() %>% 
  set_caption("Top Bay Area Tech Industries, 2020", autonum = run_autonum(seq_id='tab', bkm='toptech')) %>% 
  flextable::set_formatter("Projected Growth, 2020-2030" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("Share of Total Employment" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_table_properties(width = .5, layout='autofit')

```
```{r, ft.align="left"}
most_openings %>% select(-"Unemployment") %>% 
  flextable::flextable() %>% 
  set_caption("Occupations with the Most Job Openings", autonum = run_autonum(seq_id='tab', bkm='openings')) %>% 
  flextable::set_table_properties(width = .5, layout='autofit')
```

```{r, ft.align="left"}
most_growth %>% select(-"Unemployment") %>% 
  flextable::flextable() %>% 
  flextable::set_formatter("% Change" = function(x) sprintf("%.001f%%", x*100)) %>%
  set_caption("Fastest Growing Occupations",autonum = run_autonum(seq_id='tab', bkm='topten')) %>% 
  flextable::set_table_properties(width = .5, layout='autofit')


```


## Demographic Data 

[Provide summary-level demographic data for the service area. Disaggregate the data as appropriate for the institution’s mission and service area. Provide brief context if needed.] 


```{r, ft.align="left"}
projections %>% 
  pivot_wider(names_from = years, values_from = population) %>% 
  flextable::flextable() %>% 
  set_caption("Bay Area Population Projections", autonum = run_autonum(seq_id='tab', bkm='popproj')) %>% 
  flextable::set_table_properties(width = .4, layout='autofit')
```


```{r, ft.align="left"}
raceproj %>% 
  flextable::flextable() %>% 
  set_caption("Bay Area Population Projections by Race/Ethnicity",autonum = run_autonum(seq_id='tab', bkm='rproj')) %>% 
  flextable::set_formatter("2020" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2060" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("Percent Change" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_table_properties(width = .6, layout='autofit')
```

```{r, ft.align="left"}
race %>% flextable::flextable() %>% 
    flextable::set_caption("Service Area Racial Breakdown",autonum = run_autonum(seq_id='tab', bkm='race')) %>%     flextable::set_formatter("Bay Area: Percent" = function(x) sprintf("%.001f%%", x*100)) %>% 
    flextable::set_formatter("SC County: Percent" = function(x) sprintf("%.001f%%", x*100))%>% 
  flextable::set_table_properties(width = .5, layout='autofit')
```

```{r, ft.align="left"}
  ethnicity %>% flextable::flextable() %>% 
    set_caption("Service Area Ethnicity Breakdown",autonum = run_autonum(seq_id='tab', bkm='ethn')) %>% 
    flextable::set_formatter("Bay Area: Percent" = function(x) sprintf("%.001f%%", x*100)) %>% 
    flextable::set_formatter("SC County: Percent" = function(x) sprintf("%.001f%%", x*100))%>% 
    flextable::set_table_properties(width = .5, layout='autofit')
```




## Socio-economic Data 

[Provide summary-level socio-economic data for the service area. Disaggregate the data as appropriate for the institution’s mission and service area. Provide brief context if needed.] 

```{r, ft.align="left"}
education %>% 
  flextable::flextable() %>% 
  set_caption("Educational Attainment for Population Age 25+",autonum = run_autonum(seq_id='tab', bkm='edatt')) %>% 
  flextable::set_formatter("Bay Area: Percent" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("SC County: Percent" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_table_properties(width = .5, layout='autofit')
```


```{r, ft.align="left"}
median[1,1] <- "Median Income (dollars)"
median %>% 
  flextable::flextable() %>% 
  set_caption("Income in the Service Area",autonum = run_autonum(seq_id='tab', bkm='income')) %>% 
  flextable::set_table_properties(width = .5, layout='autofit')

```
### Poverty
```{r, ft.align='left'}
poverty %>% flextable() %>%
    flextable::set_formatter("Greater Bay Area" = function(x) sprintf("%.001f%%", x*100)) %>% 
    flextable::set_formatter("Santa Clara County" = function(x) sprintf("%.001f%%", x*100)) %>% 
    set_caption("Poverty Level in the Service Area",autonum = run_autonum(seq_id='tab', bkm='poverty')) %>% 
    flextable::set_table_properties(width = .4, layout='autofit')
```


## Sites 

[List names and locations (including addresses) of sites where 50% or more of a program, certificate, or degree is available to students, and any other off-campus sites or centers.] 

## Specialized or Programmatic Accreditation 

[Provide a list of any specialized or programmatic accreditations held by the institution.] 

# Presentation of Student Achievement Data and Institution-Set Standards 

## Course Success Rates

```{r}
title <- overallcs$title[1]
desc <- overallcs$description[1]
overallcs %>% 
  select(years, type, percentage) %>% 
  pivot_wider(names_from = years, values_from = percentage) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::set_formatter("2016-2017" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2017-2018" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2018-2019" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2019-2020" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::set_table_properties(width = .7, layout='autofit')
```
## Number of Certificate Earners

```{r}
title <- "Distinct number of CO-approved certificate earners (12+ units)"
overall603 %>% 
  select(years, type, value) %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.3)
```

## Number of Degree Earners (ADT, AS, AA)

```{r}
title <- "Distinct number of degree earners (AA, AS, or ADT) "
overall631 %>% 
  select(years, type, value) %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.3)
```
## Number of transfer degree earners

```{r}
title <- "Distinct number of ADT earners"
overall608 %>% 
  select(years, type, value) %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.3)
```

## Transfers to CSU or UC

```{r}
title <- "Distinct number of transfers to CSU or UC"
overall614 %>% 
  select(years, type, value) %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.1)
```
## Disaggregation by Gender

### Course success

```{r}
title <- "Course Success Rates by Gender"
desc <- "Note: \"All Masked Values\" contains Non-Binary and Unknown/Non-Respondent students."
csgender %>% 
  select(years, subgroup, perc) %>% 
  drop_na() %>% 
  pivot_wider(names_from = years, values_from = perc) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::set_formatter("2016-2017" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2017-2018" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2018-2019" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2019-2020" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::set_table_properties(width = .7, layout='autofit')
  
```
### Certificate Earners by Gender

```{r}
title <- "Certificate Earners by Gender"
desc <- "Note: \"All Masked Values\" contains Non-Binary and Unknown/Non-Respondent students."
ggrads603 %>% 
  select(years, subgroup, value) %>% 
  drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.3) %>% 
  flextable::add_footer_lines(values = desc)
```


### Degree Earners by Gender

```{r}
title <- "Degree Earners by Gender"
desc <- "Note: \"All Masked Values\" contains Non-Binary and Unknown/Non-Respondent students."
ggrads631%>% 
  select(years, subgroup, value) %>% 
  drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)
```

### Transfer Earners by Gender

```{r}
title <- "ADT Earners by Gender"
desc <- "Note: \"All Masked Values\" contains Non-Binary and Unknown/Non-Respondent students."
ggrads608%>% 
  select(years, subgroup, value) %>% 
  drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)
```

### CSU/UC Transfers by Gender

```{r}
title <- "Distinct Number of Transfers to CSU or UC by Gender"
desc <- "Note: \"All Masked Values\" contains Non-Binary and Unknown/Non-Respondent students."
ggrads614 %>% 
  select(years, subgroup, value) %>% 
  filter(subgroup=="Female" | subgroup=="Male" | subgroup=="All Masked Values") %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)
```




## Disaggregation by Ethnicity

### Course success

```{r}
title <- "Course Success Rates by Ethnicity"
desc <- "Note: \"All Masked Values\" contains students who listed another ethnicity or did not respond."
csrace %>% 
  select(years, subgroup, perc) %>% 
  pivot_wider(names_from = years, values_from = perc) %>% 
  drop_na() %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::set_formatter("2016-2017" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2017-2018" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2018-2019" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::set_formatter("2019-2020" = function(x) sprintf("%.001f%%", x*100)) %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3) 
  
```

### Certificate Earners by Ethnicity

```{r}
title <- "Certificate Earners by Ethnicity"
desc <- "Note: \"All Masked Values\" contains students who listed another ethnicity or did not respond."
rgrads603 %>% 
  select(years, subgroup, value) %>% 
  #drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.3) %>% 
  flextable::add_footer_lines(values = desc)
```


### Degree Earners by Ethnicity

```{r}
title <- "Degree Earners by Ethnicity"
desc <- "Note: \"All Masked Values\" contains students who listed another ethnicity or did not respond."
rgrads631%>% 
  select(years, subgroup, value) %>% 
  #drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)
```

### Transfer Earners by Ethnicity

```{r}
title <- "ADT Earners by Ethnicity"
desc <- "Note: \"All Masked Values\" contains students who listed another ethnicity or did not respond."
rgrads608%>% 
  select(years, subgroup, value) %>% 
  #drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)
```

### CSU/UC Transfers by Ethnicity

```{r}
title <- "Distinct Number of Transfers to CSU or UC by Ethnicity"
desc <- "Note: \"All Masked Values\" contains students who listed another ethnicity or not respond."
rgrads614 %>% 
  select(years, subgroup, value) %>% 
  #drop_na() %>% 
  pivot_wider(names_from = years, values_from = value) %>% 
  flextable::flextable() %>% 
  flextable::add_header_lines(values = title) %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::add_footer_lines(values = desc) %>% 
  flextable::width(width=1.3)

```

## Licensure Pass and Job Placement Rates

### Licensure Pass Rates
```{r licensure}
licensure %>% 
  select("Program", "Exam Type", "Institution Set Standard", "Stretch Goal", 
         "2016-2017", "2017-2018", "2018-2019", "2019-2020", "2020-2021") %>% 
  flextable::flextable() %>% 
  flextable::set_table_properties(width = .5, layout='autofit') %>% 
  flextable::add_header_lines(values = "Licensure Pass Rates") %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::set_formatter("Institution Set Standard" = function(x) sprintf("%.001f%%", x*100)) %>%
  flextable::set_formatter("Stretch Goal" = function(x) sprintf("%.000f%%", x*100)) %>%
  flextable::set_formatter("2016-2017" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2017-2018" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2018-2019" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2019-2020" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2020-2021" = function(x) sprintf("%.000f%%", x*100)) %>% 
  footnote(i=4, j=8, value = as_paragraph("No campus specific data on this item."), ref_symbols = c("A"), part = "body") %>%  
  footnote(i=5, j=8, value = as_paragraph("No one took the exam this year due to Covid"), ref_symbols = c("B"), part = "body")
```
### Job Placement Rates
```{r job placement}
  jobplace %>% 
    flextable::flextable() %>%
    flextable::set_formatter("Institution Set Standard" = function(x) sprintf("%.001f%%", x*100)) %>%
  flextable::set_formatter("Stretch Goal" = function(x) sprintf("%.000f%%", x*100)) %>%
  flextable::set_formatter("2018-2019" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2019-2020" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::set_formatter("2020-2021" = function(x) sprintf("%.000f%%", x*100)) %>% 
  flextable::add_header_lines(values = "Job Placement Rates") %>% 
  flextable::align(i=1, align="center", part="header") %>% 
  flextable::width(width=1.1)


```
